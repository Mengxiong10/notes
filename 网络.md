## 有了mac地址, 为什么还要ip地址

如果没有IP地址, 那么路由器要记住所有的mac地址来转发, 内存是不太可能的, ip地址设计的目的是把网络分成很多子网, 这样路由器把子网可以整体计算只需要让数据包到达那个子网就行了.

mac地址就像身份证号, IP 地址就像带着邮政编码的住址.



## web 页面请求历程

1. 主机接入网络获取本地IP地址以及其他信息

   使用DHCP发现报文完成.

   运输层UDP目的地端口地址67(DHCP服务器)和源端口地址68(DHCP客户)

   网络层目的地IP地址(255.255.255.255)进行广播和源IP地址(0.0.0.0)

   链路层目的MAC地址FF:FF:FF:FF:FF:FF 广播, 源MAC地址就是设备的MAC地址

   DHCP服务器收到后分配一个IP地址, 然后将这个IP地址, 路由器IP地址, DNS服务器的IP地址, 子网掩码信息返回, 目的MAC地址就是主机的mac地址, 然后路由记住了之前发送过来mac地址的端口, 向那个端口的主机发送这个回复, 主机就收到了IP地址和DNS服务器地址

2. ARP(地址解析协议, 将IP地址转化为MAC地址)

   有了网关路由器的IP地址, 然后通过ARP协议获取网关路由器的MAC地址

3. DNS查询

   请求主机->本地DNS服务器->根DNS服务器->顶级域名服务器->权威域名服务器

   这个过程任何DNS查询既可以是递归也可以是迭代的.

   迭代就是问完后别人直接返回让你继续问下一个, 递归就是问完后, 别人帮你问下一个, 最后再返回.

   这个过程中还有缓存, 浏览器会缓存, 操作系统host也是缓存, 本地DNS服务器也会缓存

   DNS应答报文, 包含一个或多个资源记录, 资源记录是(Name, Value, Type, TTL)的4元祖

   Type 是A | NS | CNAME | MX

   A的时候Value就是IP地址

   CNAME的时候就Value就是这个别名Name的规范主机名

   NS的时候是查询链的时候, Value就是让你问的下一个DNS的主机名

   MX: Value是别名为Name的邮件服务器的规范主机名

   TTL记录缓存的时长

4. TCP连接

   

